>>obey TEST011(tests);
>>
>>create table T011T1 (a int not null, b char(10), primary key(a));

--- SQL operation complete.
>>
>>invoke T011T1;

-- Definition of Trafodion table TRAFODION.SCH.T011T1
-- Definition current  Mon Mar 30 14:32:03 2015

  (
    A                                INT NO DEFAULT NOT NULL NOT DROPPABLE
  , B                                CHAR(10) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  )

--- SQL operation complete.
>>
>>insert into T011T1 values (1, 'a'), (2, 'b'), (3, 'c');

--- 3 row(s) inserted.
>>
>>select * from T011T1;

A            B         
-----------  ----------

          1  a         
          2  b         
          3  c         

--- 3 row(s) selected.
>>
>>select * from T011T1 where a = 2;

A            B         
-----------  ----------

          2  b         

--- 1 row(s) selected.
>>select * from t011t1 where a = 1 or a = 2;

A            B         
-----------  ----------

          1  a         
          2  b         

--- 2 row(s) selected.
>>select * from t011t1 where a = 1 or a = 4;

A            B         
-----------  ----------

          1  a         

--- 1 row(s) selected.
>>select * from t011t1 where a = 5;

--- 0 row(s) selected.
>>
>>select * from T011T1 where a > 1;

A            B         
-----------  ----------

          2  b         
          3  c         

--- 2 row(s) selected.
>>
>>select * from T011T1 where a >= 1;

A            B         
-----------  ----------

          1  a         
          2  b         
          3  c         

--- 3 row(s) selected.
>>
>>select * from t011t1 where a < 3;

A            B         
-----------  ----------

          1  a         
          2  b         

--- 2 row(s) selected.
>>select * from t011t1 where a <= 3;

A            B         
-----------  ----------

          1  a         
          2  b         
          3  c         

--- 3 row(s) selected.
>>
>>select * from t011t1 where a > 1 and a < 3;

A            B         
-----------  ----------

          2  b         

--- 1 row(s) selected.
>>select * from t011t1 where a >= 2 and a < 4;

A            B         
-----------  ----------

          2  b         
          3  c         

--- 2 row(s) selected.
>>select * from t011t1 where a >= 2 and a <= 3;

A            B         
-----------  ----------

          2  b         
          3  c         

--- 2 row(s) selected.
>>select * from t011t1 where a >= 3 and a < 5;

A            B         
-----------  ----------

          3  c         

--- 1 row(s) selected.
>>
>>select * from t011t1 where a > 4 and a < 2;

--- 0 row(s) selected.
>>
>>delete from t011t1 where a = 1;

--- 1 row(s) deleted.
>>select * from t011t1;

A            B         
-----------  ----------

          2  b         
          3  c         

--- 2 row(s) selected.
>>
>>delete from t011t1 where a > 2 and a <= 3;

--- 1 row(s) deleted.
>>select * from t011t1;

A            B         
-----------  ----------

          2  b         

--- 1 row(s) selected.
>>
>>delete from t011t1;

--- 1 row(s) deleted.
>>select * from t011t1;

--- 0 row(s) selected.
>>
>>insert into T011T1 values (1, 'a'), (2, 'b'), (3, 'c');

--- 3 row(s) inserted.
>>delete from t011t1 where a >= 3 and a < 4;

--- 1 row(s) deleted.
>>select * from t011t1;

A            B         
-----------  ----------

          1  a         
          2  b         

--- 2 row(s) selected.
>>
>>select * from (delete from t011t1 where a = 2)x;

A            B         
-----------  ----------

          2  b         

--- 1 row(s) selected.
>>select * from (delete from t011t1) x;

A            B         
-----------  ----------

          1  a         

--- 1 row(s) selected.
>>
>>cqd hbase_sql_iud_semantics 'ON';

--- SQL operation complete.
>>cqd hbase_rowset_vsbb_opt 'ON';

--- SQL operation complete.
>>cqd hbase_updel_cursor_opt 'ON';

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = 10;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_delete                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = 10 or a = 20;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         x                     2.00E+000
.    .    1    trafodion_delete                T011T1                2.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = ?;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_delete                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = ?[10];

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

6    .    7    root                            x                     1.00E+001
2    5    6    nested_join                                           1.00E+001
3    4    5    nested_join                                           1.00E+000
.    .    4    trafodion_vsbb_delet            T011T1                1.00E+000
.    .    3    trafodion_vsbb_scan             T011T1                1.00E+000
1    .    2    unpack                                                1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = 10;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = 10 or a = 20;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         x                     2.00E+000
.    .    1    trafodion_update                T011T1                2.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = b || 'z' where a = 10;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = b || 'z' where a = 10 or a = 20;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         x                     2.00E+000
.    .    1    trafodion_update                T011T1                2.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = ?;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = ?[10];

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

6    .    7    root                            x                     1.00E+001
2    5    6    nested_join                                           1.00E+001
3    4    5    nested_join                                           1.00E+000
.    .    4    trafodion_vsbb_updat            T011T1                1.00E+000
.    .    3    trafodion_vsbb_scan             T011T1                1.00E+000
1    .    2    unpack                                                1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = b || 'z' where a = ?;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = b || 'z' where a = ?[10];

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

6    .    7    root                            x                     1.00E+001
2    5    6    nested_join                                           1.00E+001
3    4    5    nested_join                                           1.00E+000
.    .    4    trafodion_vsbb_updat            T011T1                1.00E+000
.    .    3    trafodion_vsbb_scan             T011T1                1.00E+000
1    .    2    unpack                                                1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>
>>cqd hbase_sql_iud_semantics 'ON';

--- SQL operation complete.
>>cqd hbase_rowset_vsbb_opt 'ON';

--- SQL operation complete.
>>cqd hbase_updel_cursor_opt 'OFF';

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = 10;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_delete                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = 10 or a = 20;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         x                     2.00E+000
.    .    1    trafodion_delete                T011T1                2.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = ?;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_delete                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = ?[10];

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

4    .    5    root                            x                     1.00E+001
2    3    4    nested_join                                           1.00E+001
.    .    3    trafodion_vsbb_delet            T011T1                1.00E+000
1    .    2    unpack                                                1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = 10;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = 10 or a = 20;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         x                     2.00E+000
.    .    1    trafodion_update                T011T1                2.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = b || 'z' where a = 10;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = b || 'z' where a = 10 or a = 20;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         x                     2.00E+000
.    .    1    trafodion_update                T011T1                2.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = ?;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = ?[10];

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

4    .    5    root                            x                     1.00E+001
2    3    4    nested_join                                           1.00E+001
.    .    3    trafodion_vsbb_updat            T011T1                1.00E+000
1    .    2    unpack                                                1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = b || 'z' where a = ?;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = b || 'z' where a = ?[10];

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

4    .    5    root                            x                     1.00E+001
2    3    4    nested_join                                           1.00E+001
.    .    3    trafodion_update                T011T1                1.00E+000
1    .    2    unpack                                                1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>
>>cqd hbase_sql_iud_semantics 'ON';

--- SQL operation complete.
>>cqd hbase_rowset_vsbb_opt 'OFF';

--- SQL operation complete.
>>cqd hbase_updel_cursor_opt 'OFF';

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = 10;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_delete                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = 10 or a = 20;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         x                     2.00E+000
.    .    1    trafodion_delete                T011T1                2.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = ?;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_delete                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = ?[10];

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

4    .    5    root                            x                     1.00E+001
2    3    4    nested_join                                           1.00E+001
.    .    3    trafodion_delete                T011T1                1.00E+000
1    .    2    unpack                                                1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = 10;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = 10 or a = 20;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         x                     2.00E+000
.    .    1    trafodion_update                T011T1                2.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = b || 'z' where a = 10;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = b || 'z' where a = 10 or a = 20;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         x                     2.00E+000
.    .    1    trafodion_update                T011T1                2.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = ?;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = ?[10];

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

4    .    5    root                            x                     1.00E+001
2    3    4    nested_join                                           1.00E+001
.    .    3    trafodion_update                T011T1                1.00E+000
1    .    2    unpack                                                1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = b || 'z' where a = ?;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = b || 'z' where a = ?[10];

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

4    .    5    root                            x                     1.00E+001
2    3    4    nested_join                                           1.00E+001
.    .    3    trafodion_update                T011T1                1.00E+000
1    .    2    unpack                                                1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>
>>drop table if exists t011t3;

--- SQL operation complete.
>>create table if not exists t011t3 (a int not null, b int not null, c char(500), 
+>                                            primary key(a,b));

--- SQL operation complete.
>>
>>-- should return error 4246
>>prepare s from 
+>upsert using load into t011t3 (a,b) values (1,2);

--- SQL command prepared.
>>
>>prepare s from
+>upsert with no rollback into t011t3
+>  select
+>    0 + (1000 * x1000) + (100 * x100) + + (10 * x10) + x1,
+>    0 + (1000 * x1000) + (100 * x100) + + (10 * x10) + x1,
+>    'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'
+>  from (values(1)) as starter
+>    transpose 0,1,2,3,4,5,6,7,8,9 as x1000
+>    transpose 0,1,2,3,4,5,6,7,8,9 as x100
+>    transpose 0,1,2,3,4,5,6,7,8,9 as x10
+>    transpose 0,1,2,3,4,5,6,7,8,9 as x1
+>  ;

--- SQL command prepared.
>>explain options 'f' s;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

7    .    8    root                                                  1.00E+004
5    6    7    tuple_flow                                            1.00E+004
.    .    6    trafodion_vsbb_upser            T011T3                1.00E+000
4    .    5    transpose                                             1.00E+004
3    .    4    transpose                                             1.00E+003
2    .    3    transpose                                             1.00E+002
1    .    2    transpose                                             1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>execute s;

--- 10000 row(s) inserted.
>>
>>delete from t011t3;

--- 10000 row(s) deleted.
>>
>>prepare s from
+>upsert using load into t011t3
+>  select
+>    0 + (1000 * x1000) + (100 * x100) + + (10 * x10) + x1,
+>    0 + (1000 * x1000) + (100 * x100) + + (10 * x10) + x1,
+>    'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'
+>  from (values(1)) as starter
+>    transpose 0,1,2,3,4,5,6,7,8,9 as x1000
+>    transpose 0,1,2,3,4,5,6,7,8,9 as x100
+>    transpose 0,1,2,3,4,5,6,7,8,9 as x10
+>    transpose 0,1,2,3,4,5,6,7,8,9 as x1
+>  ;

--- SQL command prepared.
>>explain options 'f' s;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

7    .    8    root                                                  1.00E+004
5    6    7    tuple_flow                                            1.00E+004
.    .    6    trafodion_load                  T011T3                1.00E+000
4    .    5    transpose                                             1.00E+004
3    .    4    transpose                                             1.00E+003
2    .    3    transpose                                             1.00E+002
1    .    2    transpose                                             1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>execute s;

--- 10000 row(s) inserted.
>>
>>-- singleton plan test LP bug 1342141
>>create table T011T2 (a int not null, b char(500), 
+>                     c int not null, primary key(a))
+>salt using 4 partitions;

--- SQL operation complete.
>>
>>insert into T011T2 values (1, 'a', 11), (2, 'b', 22), (3, 'c', 33);

--- 3 row(s) inserted.
>>insert into T011T2 values (10, 'aa', 110), (20, 'bb', 220), (30, 'cc', 330);

--- 3 row(s) inserted.
>>insert into T011T2 values (11, 'aaa', 111), (22, 'bbb', 222), (33, 'ccc', 333);

--- 3 row(s) inserted.
>>update statistics for table T011T2 on every column;

--- SQL operation complete.
>>
>>-- should get serial plans
>>explain options 'f' 
+>select b, c 
+>from T011T2 
+>where a = ?;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               5.00E+001
.    .    1    trafodion_scan                  T011T2                5.00E+001

--- SQL operation complete.
>>
>>-- try with cardinality hint, still should see serial plan 
>>explain options 'f'
+>select b, c
+>from T011T2 << cardinality 1e7 >>
+>where a = ?;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               5.00E+001
.    .    1    trafodion_scan                  T011T2                5.00E+001

--- SQL operation complete.
>>
>>-- transaction optimization tests
>>delete from t011t1;

--- 0 row(s) deleted.
>>
>>-- next 4 explains should not choose external transaction
>>explain options 'f' insert into t011t1 values (1,'a');

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_insert                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = 1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_delete                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'b' where a = 1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' select * from t011t1 where a = 1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o                               1.00E+000
.    .    1    trafodion_scan                  T011T1                1.00E+000

--- SQL operation complete.
>>
>>-- next 2 explains should not choose external transaction
>>explain options 'f' upsert using load into t011t1 values (1,'a'), (2,'b');

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

3    .    4    root                                                  2.00E+000
1    2    3    tuple_flow                                            2.00E+000
.    .    2    trafodion_load                  T011T1                1.00E+000
.    .    1    tuplelist                                             2.00E+000

--- SQL operation complete.
>>explain options 'f' upsert with no rollback into t011t1 values (1,'a'), (2,'b');

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

3    .    4    root                                                  2.00E+000
1    2    3    tuple_flow                                            2.00E+000
.    .    2    trafodion_vsbb_upser            T011T1                1.00E+000
.    .    1    tuplelist                                             2.00E+000

--- SQL operation complete.
>>
>>-- next 3 explains should choose external transaction with 'return' on error
>>begin work;

--- SQL operation complete.
>>explain options 'f' insert into t011t1 values (1,'a');

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         r                     1.00E+000
.    .    1    trafodion_insert                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = 1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         r                     1.00E+000
.    .    1    trafodion_delete                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'b' where a = 1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         r                     1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>commit work;

--- SQL operation complete.
>>
>>-- next 3 explains should choose external transaction with 'return' on error
>>set transaction autocommit off;

--- SQL operation complete.
>>explain options 'f' insert into t011t1 values (1,'a');

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         r                     1.00E+000
.    .    1    trafodion_insert                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = 1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         r                     1.00E+000
.    .    1    trafodion_delete                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'b' where a = 1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         r                     1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>
>>set transaction autocommit on;

--- SQL operation complete.
>>
>>-- next 3 explains should choose external transaction with abort on error
>>explain options 'f' insert into t011t1 values (?[10], ?[10]);

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

4    .    5    root                            x                     1.00E+001
2    3    4    tuple_flow                                            1.00E+001
.    .    3    trafodion_insert                T011T1                1.00E+000
1    .    2    unpack                                                1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = ?[10];

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

4    .    5    root                            x                     1.00E+001
2    3    4    nested_join                                           1.00E+001
.    .    3    trafodion_delete                T011T1                1.00E+000
1    .    2    unpack                                                1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'z' where a = ?[10];

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

4    .    5    root                            x                     1.00E+001
2    3    4    nested_join                                           1.00E+001
.    .    3    trafodion_update                T011T1                1.00E+000
1    .    2    unpack                                                1.00E+001
.    .    1    values                                                1.00E+000

--- SQL operation complete.
>>
>>-- next 3 explains should choose external transaction with abort on error
>>create index t011t1i1 on t011t1(b);

--- SQL operation complete.
>>explain options 'f' insert into t011t1 values (1,'a');

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

3    .    4    root                  o         x                     1.00E+000
1    2    3    nested_join                                           1.00E+000
.    .    2    trafodion_insert                T011T1I1              1.00E+000
.    .    1    trafodion_insert                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = 1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

3    .    4    root                  o         x                     1.00E+000
1    2    3    nested_join                                           1.00E+000
.    .    2    trafodion_delete                T011T1I1              1.00E+000
.    .    1    trafodion_delete                T011T1                1.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'b' where a = 1;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

5    .    6    root                  o         x                     2.00E+000
1    4    5    nested_join                                           2.00E+000
2    3    4    blocked_union                                         2.00E+000
.    .    3    trafodion_insert                T011T1I1              1.00E+000
.    .    2    trafodion_delete                T011T1I1              1.00E+000
.    .    1    trafodion_update                T011T1                1.00E+000

--- SQL operation complete.
>>drop index t011t1i1;

--- SQL operation complete.
>>
>>-- next 4 explain should choose external transaction with abort on error
>>explain options 'f' insert into t011t1 values (1,'a'), (2,'b');

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

3    .    4    root                            x                     2.00E+000
1    2    3    tuple_flow                                            2.00E+000
.    .    2    trafodion_insert                T011T1                1.00E+000
.    .    1    tuplelist                                             2.00E+000

--- SQL operation complete.
>>explain options 'f' delete from t011t1 where a = 1 or a = 2;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         x                     2.00E+000
.    .    1    trafodion_delete                T011T1                2.00E+000

--- SQL operation complete.
>>explain options 'f' update t011t1 set b = 'b' where a = 1 or a = 2;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                  o         x                     2.00E+000
.    .    1    trafodion_update                T011T1                2.00E+000

--- SQL operation complete.
>>explain options 'f' insert into t011t1 select a,c from t011t3;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

3    .    4    root                            x                     1.00E+002
1    2    3    tuple_flow                                            1.00E+002
.    .    2    trafodion_insert                T011T1                1.00E+000
.    .    1    trafodion_scan                  T011T3                1.00E+002

--- SQL operation complete.
>>
>>
>>
>>
>>-- test for update/delete where current of
>>cqd hbase_sql_iud_semantics reset;

--- SQL operation complete.
>>cqd hbase_rowset_vsbb_opt reset;

--- SQL operation complete.
>>cqd hbase_updel_cursor_opt reset;

--- SQL operation complete.
>>set envvar sqlci_cursor;

--- SQL operation complete.
>>
>>delete from t011t1;

--- 0 row(s) deleted.
>>insert into T011T1 values (1, 'a'), (2, 'b');

--- 2 row(s) inserted.
>>
>>declare c cursor for select * from t011t1 for update of b;

--- SQL operation complete.
>>open c;

--- SQL operation complete.
>>fetch c;

A            B         
-----------  ----------

          1  a         

--- 1 row(s) selected.
>>update t011t1 set b = 'aa' where current of c;

--- 1 row(s) updated.
>>fetch c;

A            B         
-----------  ----------

          2  b         

--- 1 row(s) selected.
>>update t011t1 set b = 'bb' where current of c;

--- 1 row(s) updated.
>>update t011t1 set b = 'bb' where current of c;

*** WARNING[8106] The last row fetched by this cursor was updated or deleted between the FETCH and UPDATE/DELETE...WHERE CURRENT... of statements.

--- 1 row(s) updated.
>>fetch c;

--- 0 row(s) selected.
>>update t011t1 set b = 'bb' where current of c;

*** ERROR[8013] You are trying to update or delete from a cursor that is not in the fetched state.

--- 0 row(s) updated.
>>close c;

--- SQL operation complete.
>>select * from t011t1;

A            B         
-----------  ----------

          1  aa        
          2  bb        

--- 2 row(s) selected.
>>
>>open c;

--- SQL operation complete.
>>fetch c;

A            B         
-----------  ----------

          1  aa        

--- 1 row(s) selected.
>>delete from t011t1 where current of c;

--- 1 row(s) deleted.
>>select * from t011t1;

A            B         
-----------  ----------

          2  bb        

--- 1 row(s) selected.
>>fetch c;

A            B         
-----------  ----------

          2  bb        

--- 1 row(s) selected.
>>delete from t011t1 where current of c;

--- 1 row(s) deleted.
>>fetch c;

--- 0 row(s) selected.
>>delete from t011t1 where current of c;

*** ERROR[8013] You are trying to update or delete from a cursor that is not in the fetched state.

--- 0 row(s) deleted.
>>close c;

--- SQL operation complete.
>>
>>select * from t011t1;

--- 0 row(s) selected.
>>
>>
>>-- tests for large columns
>>create table t011t4 (a char(200000), b varchar(200000), c char(200000 bytes) character set utf8, d varchar(200000 bytes) character set utf8);

--- SQL operation complete.
>>insert into t011t4 values ('a', repeat('b', 200), 'c', repeat('d', 400));

--- 1 row(s) inserted.
>>select left (a, 20), left(b, 10), left(c, 10), left (d, 11) from t011t4;

(EXPR)                (EXPR)      (EXPR)                                    (EXPR)
--------------------  ----------  ----------------------------------------  --------------------------------------------

a                     bbbbbbbbbb  c                                         ddddddddddd                                 

--- 1 row(s) selected.
>>
>>update t011t4 set b = repeat('b', 100000);

--- 1 row(s) updated.
>>select left(b, 50) from t011t4;

(EXPR)                                            
--------------------------------------------------

bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb

--- 1 row(s) selected.
>>
>>upsert into t011t4 values ('a', repeat('b', 100000), 'c', repeat('d', 100000)),
+>                               ('a', repeat('b', 50000), 'c', repeat('d', 50000));

--- 2 row(s) inserted.
>>select left (a, 20), left(b, 10), left(c, 10), left (d, 11) from t011t4;

(EXPR)                (EXPR)      (EXPR)                                    (EXPR)
--------------------  ----------  ----------------------------------------  --------------------------------------------

a                     bbbbbbbbbb  c                                         ddddddddddd                                 
a                     bbbbbbbbbb  c                                         ddddddddddd                                 
a                     bbbbbbbbbb  c                                         ddddddddddd                                 

--- 3 row(s) selected.
>>
>>-- negative test
>>create table t011t5 (a char(200000), b varchar(200000), c char(200000 bytes) character set utf8, d varchar(200001 bytes) character set utf8);

*** ERROR[4247] Specified size in bytes (200001) exceeds the maximum size allowed (200000) for column D.

--- SQL operation failed with errors.
>>
>>-- tests for repository explain
>>-- check for repository tables
>>get tables in schema trafodion."_REPOS_";

Tables in Schema TRAFODION._REPOS_
==================================

METRIC_QUERY_AGGR_TABLE
METRIC_QUERY_TABLE
METRIC_SESSION_TABLE
METRIC_TEXT_TABLE

--- SQL operation complete.
>>invoke trafodion."_REPOS_".metric_query_table;

-- Definition of Trafodion table TRAFODION."_REPOS_".METRIC_QUERY_TABLE
-- Definition current  Mon Mar 30 14:33:12 2015

  (
    INSTANCE_ID                      INT UNSIGNED NO DEFAULT NOT NULL NOT
      DROPPABLE
  , TENANT_ID                        INT UNSIGNED NO DEFAULT NOT NULL NOT
      DROPPABLE
  , COMPONENT_ID                     INT UNSIGNED DEFAULT NULL
  , PROCESS_ID                       INT DEFAULT NULL
  , THREAD_ID                        INT UNSIGNED DEFAULT NULL
  , NODE_ID                          INT UNSIGNED DEFAULT NULL
  , PNID_ID                          INT UNSIGNED DEFAULT NULL
  , HOST_ID                          INT UNSIGNED NO DEFAULT NOT NULL NOT
      DROPPABLE
  , IP_ADDRESS_ID                    CHAR(32) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , SEQUENCE_NUMBER                  INT UNSIGNED DEFAULT NULL
  , PROCESS_NAME                     CHAR(32) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , EXEC_START_UTC_TS                TIMESTAMP(6) NO DEFAULT NOT NULL NOT
      DROPPABLE
  , QUERY_ID                         CHAR(160) CHARACTER SET ISO88591 COLLATE
      DEFAULT NO DEFAULT NOT NULL NOT DROPPABLE
  , USER_NAME                        CHAR(256 BYTES) CHARACTER SET UTF8 COLLATE
      DEFAULT DEFAULT NULL
  , ROLE_NAME                        CHAR(256 BYTES) CHARACTER SET UTF8 COLLATE
      DEFAULT DEFAULT NULL
  , START_PRIORITY                   INT UNSIGNED DEFAULT NULL
  , MASTER_PROCESS_ID                CHAR(64) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , SESSION_ID                       CHAR(108) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , CLIENT_NAME                      VARCHAR(1024) CHARACTER SET ISO88591
      COLLATE DEFAULT DEFAULT NULL
  , APPLICATION_NAME                 CHAR(130) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , STATEMENT_ID                     CHAR(160) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , STATEMENT_TYPE                   CHAR(36) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , STATEMENT_SUBTYPE                CHAR(36) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , SUBMIT_UTC_TS                    TIMESTAMP(6) DEFAULT NULL
  , COMPILE_START_UTC_TS             TIMESTAMP(6) DEFAULT NULL
  , COMPILE_END_UTC_TS               TIMESTAMP(6) DEFAULT NULL
  , COMPILE_ELAPSED_TIME             LARGEINT DEFAULT NULL
  , CMP_AFFINITY_NUM                 LARGEINT DEFAULT NULL
  , CMP_DOP                          LARGEINT DEFAULT NULL
  , CMP_TXN_NEEDED                   LARGEINT DEFAULT NULL
  , CMP_MANDATORY_X_PROD             LARGEINT DEFAULT NULL
  , CMP_MISSING_STATS                LARGEINT DEFAULT NULL
  , CMP_NUM_JOINS                    LARGEINT DEFAULT NULL
  , CMP_FULL_SCAN_ON_TABLE           LARGEINT DEFAULT NULL
  , CMP_ROWS_ACCESSED_FULL_SCAN      DOUBLE PRECISION DEFAULT NULL
  , EST_ACCESSED_ROWS                DOUBLE PRECISION DEFAULT NULL
  , EST_USED_ROWS                    DOUBLE PRECISION DEFAULT NULL
  , CMP_COMPILER_ID                  CHAR(28) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , CMP_CPU_PATH_LENGTH              LARGEINT DEFAULT NULL
  , CMP_CPU_BINDER                   LARGEINT DEFAULT NULL
  , CMP_CPU_NORMALIZER               LARGEINT DEFAULT NULL
  , CMP_CPU_ANALYZER                 LARGEINT DEFAULT NULL
  , CMP_CPU_OPTIMIZER                LARGEINT DEFAULT NULL
  , CMP_CPU_GENERATOR                LARGEINT DEFAULT NULL
  , CMP_METADATA_CACHE_HITS          LARGEINT DEFAULT NULL
  , CMP_METADATA_CACHE_LOOKUPS       LARGEINT DEFAULT NULL
  , CMP_QUERY_CACHE_STATUS           LARGEINT DEFAULT NULL
  , CMP_HISTOGRAM_CACHE_HITS         LARGEINT DEFAULT NULL
  , CMP_HISTOGRAM_CACHE_LOOKUPS      LARGEINT DEFAULT NULL
  , CMP_STMT_HEAP_SIZE               LARGEINT DEFAULT NULL
  , CMP_CONTEXT_HEAP_SIZE            LARGEINT DEFAULT NULL
  , CMP_OPTIMIZATION_TASKS           LARGEINT DEFAULT NULL
  , CMP_OPTIMIZATION_CONTEXTS        LARGEINT DEFAULT NULL
  , CMP_IS_RECOMPILE                 SMALLINT DEFAULT NULL
  , EST_NUM_SEQ_IOS                  DOUBLE PRECISION DEFAULT NULL
  , EST_NUM_RAND_IOS                 DOUBLE PRECISION DEFAULT NULL
  , EST_COST                         DOUBLE PRECISION DEFAULT NULL
  , EST_CARDINALITY                  DOUBLE PRECISION DEFAULT NULL
  , EST_IO_TIME                      DOUBLE PRECISION DEFAULT NULL
  , EST_MSG_TIME                     DOUBLE PRECISION DEFAULT NULL
  , EST_IDLE_TIME                    DOUBLE PRECISION DEFAULT NULL
  , EST_CPU_TIME                     DOUBLE PRECISION DEFAULT NULL
  , EST_TOTAL_TIME                   DOUBLE PRECISION DEFAULT NULL
  , EST_TOTAL_MEM                    DOUBLE PRECISION DEFAULT NULL
  , EST_RESOURCE_USAGE               LARGEINT DEFAULT NULL
  , AGGREGATE_OPTION                 CHAR(3) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , CMP_NUMBER_OF_BMOS               INT DEFAULT NULL
  , CMP_OVERFLOW_MODE                CHAR(10) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , CMP_OVERFLOW_SIZE                LARGEINT DEFAULT NULL
  , AGGREGATE_TOTAL                  LARGEINT DEFAULT NULL
  , STATS_ERROR_CODE                 INT DEFAULT NULL
  , QUERY_ELAPSED_TIME               LARGEINT DEFAULT NULL
  , SQL_PROCESS_BUSY_TIME            LARGEINT DEFAULT NULL
  , DISK_PROCESS_BUSY_TIME           LARGEINT DEFAULT NULL
  , DISK_IOS                         LARGEINT DEFAULT NULL
  , NUM_SQL_PROCESSES                LARGEINT DEFAULT NULL
  , SQL_SPACE_ALLOCATED              LARGEINT DEFAULT NULL
  , SQL_SPACE_USED                   LARGEINT DEFAULT NULL
  , SQL_HEAP_ALLOCATED               LARGEINT DEFAULT NULL
  , SQL_HEAP_USED                    LARGEINT DEFAULT NULL
  , TOTAL_MEM_ALLOC                  LARGEINT DEFAULT NULL
  , MAX_MEM_USED                     LARGEINT DEFAULT NULL
  , TRANSACTION_ID                   CHAR(25) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , NUM_REQUEST_MSGS                 LARGEINT DEFAULT NULL
  , NUM_REQUEST_MSG_BYTES            LARGEINT DEFAULT NULL
  , NUM_REPLY_MSGS                   LARGEINT DEFAULT NULL
  , NUM_REPLY_MSG_BYTES              LARGEINT DEFAULT NULL
  , FIRST_RESULT_RETURN_UTC_TS       TIMESTAMP(6) DEFAULT NULL
  , ROWS_RETURNED_TO_MASTER          LARGEINT DEFAULT NULL
  , PARENT_QUERY_ID                  CHAR(160) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , PARENT_SYSTEM_NAME               CHAR(128) CHARACTER SET ISO88591 COLLATE
      DEFAULT DEFAULT NULL
  , EXEC_END_UTC_TS                  TIMESTAMP(6) DEFAULT NULL
  , MASTER_EXECUTION_TIME            LARGEINT DEFAULT NULL
  , MASTER_ELAPSED_TIME              LARGEINT DEFAULT NULL
  , QUERY_STATUS                     CHAR(21 CHARS) CHARACTER SET UTF8 COLLATE
      DEFAULT DEFAULT NULL
  , QUERY_SUB_STATUS                 CHAR(30 CHARS) CHARACTER SET UTF8 COLLATE
      DEFAULT DEFAULT NULL
  , ERROR_CODE                       INT DEFAULT NULL
  , SQL_ERROR_CODE                   INT DEFAULT NULL
  , ERROR_TEXT                       VARCHAR(2000 CHARS) CHARACTER SET UTF8
      COLLATE DEFAULT DEFAULT NULL
  , QUERY_TEXT                       VARCHAR(50000 CHARS) CHARACTER SET UTF8
      COLLATE DEFAULT DEFAULT NULL
  , EXPLAIN_PLAN                     VARCHAR(200000) CHARACTER SET ISO88591
      COLLATE DEFAULT DEFAULT NULL
  , LAST_ERROR_BEFORE_AQR            INT DEFAULT NULL
  , DELAY_TIME_BEFORE_AQR_SEC        LARGEINT DEFAULT NULL
  , TOTAL_NUM_AQR_RETRIES            LARGEINT DEFAULT NULL
  , MSG_BYTES_TO_DISK                LARGEINT DEFAULT NULL
  , MSGS_TO_DISK                     LARGEINT DEFAULT NULL
  , ROWS_ACCESSED                    LARGEINT DEFAULT NULL
  , ROWS_RETRIEVED                   LARGEINT DEFAULT NULL
  , NUM_ROWS_IUD                     LARGEINT DEFAULT NULL
  , PROCESSES_CREATED                LARGEINT DEFAULT NULL
  , PROCESS_CREATE_BUSY_TIME         LARGEINT DEFAULT NULL
  , OVF_FILE_COUNT                   LARGEINT DEFAULT NULL
  , OVF_SPACE_ALLOCATED              LARGEINT DEFAULT NULL
  , OVF_SPACE_USED                   LARGEINT DEFAULT NULL
  , OVF_BLOCK_SIZE                   LARGEINT DEFAULT NULL
  , OVF_WRITE_READ_COUNT             LARGEINT DEFAULT NULL
  , OVF_WRITE_COUNT                  LARGEINT DEFAULT NULL
  , OVF_BUFFER_BLOCKS_WRITTEN        LARGEINT DEFAULT NULL
  , OVF_BUFFER_BYTES_WRITTEN         LARGEINT DEFAULT NULL
  , OVF_READ_COUNT                   LARGEINT DEFAULT NULL
  , OVF_BUFFER_BLOCKS_READ           LARGEINT DEFAULT NULL
  , OVF_BUFFER_BYTES_READ            LARGEINT DEFAULT NULL
  , NUM_NODES                        LARGEINT DEFAULT NULL
  , UDR_PROCESS_BUSY_TIME            LARGEINT DEFAULT NULL
  , PERTABLE_STATS                   INT DEFAULT NULL
  )

--- SQL operation complete.
>>
>>-- delete explain for statement explstmt from repository
>>set parserflags 131072;

--- SQL operation complete.
>>delete from trafodion."_REPOS_".metric_query_table
+>  where query_id like 'MXID%EXPLSTMT%';

--- 0 row(s) deleted.
>>reset parserflags 131072;

--- SQL operation complete.
>>
>>-- prepare stmt and store explain in repository
>>prepare explstmt from select * from t011t1;

--- SQL command prepared.
>>store explain for explstmt in repository;

--- SQL operation complete.
>>
>>-- get qid for the prepared stmt
>>get qid for statement explstmt;

MXID11000023640212294511071485546000000000206U3333300_3011_EXPLSTMT

--- SQL operation complete.
>>
>>-- retrieve explain plan from repository based on the qid and return it.
>>select seq_num, operator from table(explain(null, 
+>    'EXPLAIN_QID=' || (get qid for statement explstmt))) 
+>  order by seq_num desc;

SEQ_NUM      OPERATOR                      
-----------  ------------------------------

          2  ROOT                          
          1  TRAFODION_SCAN                

--- 2 row(s) selected.
>>
>>-- return explain info from the input explain plan
>>select seq_num, operator from table(explain(null,
+>   'EXPLAIN_PLAN=' || (select explain_plan from trafodion."_REPOS_".metric_query_table
+>                                   where query_id = (get qid for statement explstmt))))
+>  order by seq_num desc;

SEQ_NUM      OPERATOR                      
-----------  ------------------------------

          2  ROOT                          
          1  TRAFODION_SCAN                

--- 2 row(s) selected.
>>
>>-- compile and explain a statement.
>>select seq_num, operator from table(explain(null, 
+>       'EXPLAIN_STMT=select * from t011t1'))
+>  order by seq_num desc;

SEQ_NUM      OPERATOR                      
-----------  ------------------------------

          2  ROOT                          
          1  TRAFODION_SCAN                

--- 2 row(s) selected.
>>
>>
>>-- prepare stmt and store it with a user specified query id.
>>-- this is to test formatted explain display based on a query id.
>>prepare explstmt2 from select * from t011t1;

--- SQL command prepared.
>>get qid for statement explstmt2;

MXID11000023640212294511071485546000000000206U3333300_3022_EXPLSTMT2

--- SQL operation complete.
>>set qid MXID123456 for explstmt2;

>>get qid for statement explstmt2;

MXID123456

--- SQL operation complete.
>>
>>store explain for explstmt2 in repository;

--- SQL operation complete.
>>explain options 'f' qid MXID123456 from repository;

LC   RC   OP   OPERATOR              OPT       DESCRIPTION           CARD
---- ---- ---- --------------------  --------  --------------------  ---------

1    .    2    root                                                  1.00E+002
.    .    1    trafodion_scan                  T011T1                1.00E+002

--- SQL operation complete.
>>log;
