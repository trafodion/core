#!/bin/bash

# Builds HBase TRX jar for the default version of Java (as per JAVA_HOME)

BUILD_TRX_LOG=$PWD/build_trx.log

cd src/main/java
find . -name "*.java" | xargs ${JAVA_HOME}/bin/javac 
build_status=$?
echo "return code after compile: ${build_status}"
if [[ ${build_status} != 0 ]]; then
    exit 1
fi
echo "`date`" >> ${BUILD_TRX_LOG}
echo "Begin: Building ${BLD_HBASE_TRX_JAR}" | tee -a ${BUILD_TRX_LOG}
echo "JAVA_HOME: ${JAVA_HOME}" | tee -a ${BUILD_TRX_LOG}
${JAVA_HOME}/bin/jar -cvf ../../../${BLD_HBASE_TRX_JAR} . >> ${BUILD_TRX_LOG} 
jar_build_status=$?
echo "return code for the jar build step: ${jar_build_status}"
if [[ ${jar_build_status} != 0 ]]; then
    exit 1
fi
echo "Done: Building ${BLD_HBASE_TRX_JAR}" | tee -a ${BUILD_TRX_LOG}
echo "====================================" >> ${BUILD_TRX_LOG}
echo "${BLD_HBASE_TRX_JAR} build log in ${BUILD_TRX_LOG}"

cp -f ../../../${BLD_HBASE_TRX_JAR} ${MY_SQROOT}/export/lib/  || exit 1

exit 0
